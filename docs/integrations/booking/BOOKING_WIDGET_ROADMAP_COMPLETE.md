# Sistema de Reservas - Hoja de Ruta Completa

> **Fecha:** 26 Enero 2026
> **Estado:** Pendiente de implementaciÃ³n
> **Objetivo:** Sistema completo de reservas con magic links, recordatorios y autogestiÃ³n

---

## Ãndice

1. [Stack TecnolÃ³gico](#stack-tecnolÃ³gico)
2. [Flujo Completo del Sistema](#flujo-completo-del-sistema)
3. [Proceso de ReprogramaciÃ³n y CancelaciÃ³n](#proceso-de-reprogramaciÃ³n-y-cancelaciÃ³n)
4. [Sistema de Recordatorios](#sistema-de-recordatorios)
5. [Estructura de Datos Redis](#estructura-de-datos-redis)
6. [APIs a Implementar](#apis-a-implementar)
7. [Setup Upstash](#setup-upstash)
8. [Variables de Entorno](#variables-de-entorno)
9. [Planning de Seguimiento](#planning-de-seguimiento)
10. [Costes](#costes)

---

## Stack TecnolÃ³gico

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ARQUITECTURA COMPLETA                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  FRONTEND                    BACKEND                    SERVICIOS EXTERNOS   â”‚
â”‚  â•â•â•â•â•â•â•â•                    â•â•â•â•â•â•â•                    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                              â”‚
â”‚  React 19 + Vite             Vercel Functions           Momence OAuth2       â”‚
â”‚  BookingWidgetV2             /api/reservar              (Bookings + Leads)   â”‚
â”‚  ManageBookingPage           /api/booking/*                                  â”‚
â”‚                              /api/cron/*                Meta CAPI            â”‚
â”‚                                                         (Conversion â‚¬90)     â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     UPSTASH (100% GRATUITO)                           â”‚   â”‚
â”‚  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  REDIS                              QSTASH (CRON)                     â”‚   â”‚
â”‚  â”‚  â€¢ Cache clases (15 min)            â€¢ 500 mensajes/dÃ­a gratis        â”‚   â”‚
â”‚  â”‚  â€¢ DeduplicaciÃ³n leads (90 dÃ­as)    â€¢ Reintentos automÃ¡ticos         â”‚   â”‚
â”‚  â”‚  â€¢ Storage reservas                 â€¢ VerificaciÃ³n firma (seguro)    â”‚   â”‚
â”‚  â”‚  â€¢ Ãndices para bÃºsqueda            â€¢ Sin lÃ­mite de schedules        â”‚   â”‚
â”‚  â”‚  â€¢ 10,000 comandos/dÃ­a gratis       â€¢ Callbacks y delays             â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     COMUNICACIONES                                    â”‚   â”‚
â”‚  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  WHATSAPP (Meta Cloud API)          RESEND (Email)                   â”‚   â”‚
â”‚  â”‚  â€¢ 1,000 conversaciones/mes         â€¢ 3,000 emails/mes gratis        â”‚   â”‚
â”‚  â”‚  â€¢ Templates pre-aprobados          â€¢ Dominio verificado             â”‚   â”‚
â”‚  â”‚  â€¢ Botones interactivos             â€¢ Templates React                â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Flujo Completo del Sistema

### 1. Reserva Nueva (T=0)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RESERVA NUEVA                                                               â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                                                                              â”‚
â”‚  Usuario â†’ BookingWidgetV2 â†’ POST /api/reservar                             â”‚
â”‚                                                                              â”‚
â”‚  El endpoint ejecuta:                                                        â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 1. VALIDACIÃ“N                                                        â”‚    â”‚
â”‚  â”‚    â€¢ Email vÃ¡lido (RFC)                                             â”‚    â”‚
â”‚  â”‚    â€¢ TelÃ©fono vÃ¡lido (E.164)                                        â”‚    â”‚
â”‚  â”‚    â€¢ Consents RGPD (terms, privacy, age)                            â”‚    â”‚
â”‚  â”‚    â€¢ Heels consent (si aplica)                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â†“                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 2. DEDUPLICACIÃ“N                                                     â”‚    â”‚
â”‚  â”‚    â€¢ GET booking:{email} de Redis                                   â”‚    â”‚
â”‚  â”‚    â€¢ Si existe Y status=confirmed â†’ RECHAZAR "Ya tienes reserva"    â”‚    â”‚
â”‚  â”‚    â€¢ Si no existe O status=cancelled â†’ CONTINUAR                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â†“                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 3. MOMENCE                                                           â”‚    â”‚
â”‚  â”‚    â€¢ Buscar/crear member por email                                  â”‚    â”‚
â”‚  â”‚    â€¢ Crear booking en sessionId â†’ obtener bookingId                 â”‚    â”‚
â”‚  â”‚    â€¢ Enviar a Customer Leads (campos custom)                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â†“                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 4. GENERAR MAGIC LINK                                                â”‚    â”‚
â”‚  â”‚    â€¢ managementToken = crypto.randomBytes(16).toString('hex')       â”‚    â”‚
â”‚  â”‚    â€¢ URL: /gestionar-reserva?token={managementToken}                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â†“                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 5. GUARDAR EN REDIS                                                  â”‚    â”‚
â”‚  â”‚    â€¢ SETEX booking:{email} â†’ datos completos (TTL 30 dÃ­as)          â”‚    â”‚
â”‚  â”‚    â€¢ SETEX mgmt:{token} â†’ email (Ã­ndice inverso)                    â”‚    â”‚
â”‚  â”‚    â€¢ SADD reminders:{fecha} â†’ email (para cron)                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â†“                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 6. TRACKING                                                          â”‚    â”‚
â”‚  â”‚    â€¢ POST evento "Lead" a Meta CAPI (valor â‚¬90)                     â”‚    â”‚
â”‚  â”‚    â€¢ eventId Ãºnico para deduplicaciÃ³n con Pixel                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â†“                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 7. CONFIRMACIÃ“N INMEDIATA                                            â”‚    â”‚
â”‚  â”‚    â€¢ Email via Resend (template de confirmaciÃ³n)                    â”‚    â”‚
â”‚  â”‚    â€¢ WhatsApp opcional (confirmaciÃ³n instantÃ¡nea)                   â”‚    â”‚
â”‚  â”‚    â€¢ Incluir magic link en ambos                                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â†“                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 8. RESPUESTA                                                         â”‚    â”‚
â”‚  â”‚    { success: true, managementToken, message: "Reserva confirmada" }â”‚    â”‚
â”‚  â”‚    Widget muestra: BookingSuccess con confetti ğŸ‰                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Proceso de ReprogramaciÃ³n y CancelaciÃ³n

### Flujo Visual de AutogestiÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                              â”‚
â”‚  USUARIO RECIBE EMAIL/WHATSAPP CON MAGIC LINK                               â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                               â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ğŸ“§ Email de confirmaciÃ³n/recordatorio                               â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  "Â¡Hola MarÃ­a! Tu clase de Bachata estÃ¡ confirmada..."              â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚    â”‚
â”‚  â”‚  â”‚  Ver mi reserva  â”‚  â”‚ Cambiar/Cancelar â”‚                         â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚    â”‚
â”‚  â”‚           â”‚                     â”‚                                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚              â”‚                     â”‚                                         â”‚
â”‚              â–¼                     â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  /gestionar-reserva?token=abc123def456                              â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚                                                                â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  ğŸ‰ Tu reserva de clase de prueba                             â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                                â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  ğŸ“š Clase: Bachata Sensual - Principiantes              â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  ğŸ“… Fecha: Lunes 28 de Enero 2026                       â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  ğŸ• Hora: 19:00h                                        â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  ğŸ‘¨â€ğŸ« Instructor: Mathias & Eugenia                       â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚                                                          â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  ğŸ“ Farray's International Dance Center                 â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚     C/ EntenÃ§a 100, 08015 Barcelona                     â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                                â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ ğŸ“ Ver mapa â”‚ â”‚ ğŸ“… AÃ±adir   â”‚ â”‚ âŒ Cancelar reserva     â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚             â”‚ â”‚  calendario â”‚ â”‚    (botÃ³n rojo)         â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                              â”‚                 â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  ğŸ’¡ Â¿Quieres otra fecha u horario?        â”‚               â”‚â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚                                           â”‚               â”‚â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  Cancela esta reserva y elige una nueva   â–¼               â”‚â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  clase en nuestro calendario.     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚                                   â”‚ Modal confirmaciÃ³nâ”‚   â”‚â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  [Ver calendario de clases â†’]     â”‚                   â”‚   â”‚â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Â¿Seguro que      â”‚â”€â”€â”€â”˜â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                      â”‚ quieres cancelar? â”‚    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                      â”‚                   â”‚    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                      â”‚ [No] [SÃ­, cancelar]    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                                â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Flujo de CancelaciÃ³n (Detallado)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CANCELACIÃ“N DE RESERVA                                                      â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                                                                              â”‚
â”‚  Usuario click "Cancelar" â†’ Modal confirmaciÃ³n â†’ "SÃ­, cancelar"             â”‚
â”‚                                                                              â”‚
â”‚                              â†“                                               â”‚
â”‚                                                                              â”‚
â”‚  POST /api/booking/cancel { token: "abc123def456" }                         â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 1. VALIDAR TOKEN                                                     â”‚    â”‚
â”‚  â”‚    â€¢ GET mgmt:{token} â†’ email                                       â”‚    â”‚
â”‚  â”‚    â€¢ Si no existe â†’ 404 "Token invÃ¡lido o expirado"                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â†“                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 2. OBTENER RESERVA                                                   â”‚    â”‚
â”‚  â”‚    â€¢ GET booking:{email} â†’ datos                                    â”‚    â”‚
â”‚  â”‚    â€¢ Si status=cancelled â†’ 400 "Ya estÃ¡ cancelada"                  â”‚    â”‚
â”‚  â”‚    â€¢ Si classDate < hoy â†’ 400 "Clase ya pasada"                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â†“                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 3. CANCELAR EN MOMENCE                                               â”‚    â”‚
â”‚  â”‚    â€¢ DELETE /api/v2/host/session-bookings/{bookingId}               â”‚    â”‚
â”‚  â”‚    â€¢ Si falla â†’ log error pero continuar (cancelaciÃ³n local)        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â†“                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 4. LIMPIAR REDIS (CRÃTICO - permite nueva reserva)                   â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚    await Promise.all([                                              â”‚    â”‚
â”‚  â”‚      redis.del(`booking:${email}`),      // Eliminar reserva        â”‚    â”‚
â”‚  â”‚      redis.del(`mgmt:${token}`),         // Eliminar Ã­ndice token   â”‚    â”‚
â”‚  â”‚      redis.srem(`reminders:${fecha}`, email), // Quitar de cron     â”‚    â”‚
â”‚  â”‚    ]);                                                              â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚    âš ï¸ IMPORTANTE: Si no se limpia, el usuario no podrÃ¡ reservar     â”‚    â”‚
â”‚  â”‚       de nuevo porque la deduplicaciÃ³n lo rechazarÃ¡                 â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â†“                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 5. NOTIFICAR CANCELACIÃ“N                                             â”‚    â”‚
â”‚  â”‚    â€¢ Email via Resend: "Tu reserva ha sido cancelada"               â”‚    â”‚
â”‚  â”‚    â€¢ Incluir CTA: "Reserva otra clase cuando quieras"               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â†“                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 6. RESPUESTA                                                         â”‚    â”‚
â”‚  â”‚    { success: true, redirectUrl: "/reservas?cancelled=true" }       â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚    Frontend redirige con mensaje:                                   â”‚    â”‚
â”‚  â”‚    "âœ… Reserva cancelada. Â¡Esperamos verte pronto!"                 â”‚    â”‚
â”‚  â”‚    [Reservar otra clase]                                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Flujo de ReprogramaciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  REPROGRAMACIÃ“N DE RESERVA                                                   â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                                                                              â”‚
â”‚  âš ï¸ NO hay reprogramaciÃ³n directa. El flujo es:                             â”‚
â”‚     CANCELAR â†’ RESERVAR NUEVA                                               â”‚
â”‚                                                                              â”‚
â”‚  Â¿Por quÃ©?                                                                   â”‚
â”‚  â€¢ Simplicidad: Una sola API de reserva, una de cancelaciÃ³n                 â”‚
â”‚  â€¢ Momence: No tiene API de "modificar booking", solo crear/eliminar        â”‚
â”‚  â€¢ UX clara: El usuario entiende que cancela y reserva otra                 â”‚
â”‚  â€¢ Sin conflictos: No hay race conditions de disponibilidad                 â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  FLUJO DE REPROGRAMACIÃ“N                                             â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  1. Usuario en /gestionar-reserva                                   â”‚    â”‚
â”‚  â”‚     â””â”€â†’ Click "Cancelar reserva"                                    â”‚    â”‚
â”‚  â”‚         â””â”€â†’ Confirma en modal                                       â”‚    â”‚
â”‚  â”‚             â””â”€â†’ POST /api/booking/cancel                            â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  2. Redirect a /reservas?cancelled=true                             â”‚    â”‚
â”‚  â”‚     â””â”€â†’ Banner: "Reserva cancelada. Elige otra fecha:"              â”‚    â”‚
â”‚  â”‚         â””â”€â†’ BookingWidgetV2 se muestra                              â”‚    â”‚
â”‚  â”‚             â””â”€â†’ Usuario elige nueva clase                           â”‚    â”‚
â”‚  â”‚                 â””â”€â†’ POST /api/reservar (nueva reserva)              â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  3. ConfirmaciÃ³n de nueva reserva                                   â”‚    â”‚
â”‚  â”‚     â””â”€â†’ Email + WhatsApp con nuevo magic link                       â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  ALTERNATIVA FUTURA (v2):                                                    â”‚
â”‚  Si se necesita reprogramaciÃ³n directa, crear:                              â”‚
â”‚  â€¢ /api/booking/reschedule                                                  â”‚
â”‚  â€¢ UI con selector de nueva fecha/hora                                      â”‚
â”‚  â€¢ Internamente: cancel + create atÃ³mico                                    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Sistema de Recordatorios

### Timeline de Comunicaciones

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                              â”‚
â”‚  TIMELINE DE COMUNICACIONES                                                  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                                                                              â”‚
â”‚  T=0 (Reserva)          T-24h              T-2h              T+24h          â”‚
â”‚      â”‚                    â”‚                  â”‚                  â”‚            â”‚
â”‚      â–¼                    â–¼                  â–¼                  â–¼            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ EMAIL â”‚           â”‚ EMAIL â”‚          â”‚WHATSAPPâ”‚          â”‚ EMAIL â”‚        â”‚
â”‚  â”‚CONFIRMâ”‚           â”‚+WHATS â”‚          â”‚ ONLY   â”‚          â”‚FEEDBACKâ”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                              â”‚
â”‚  Contenido:          Contenido:         Contenido:         Contenido:       â”‚
â”‚  â€¢ ConfirmaciÃ³n      â€¢ Recordatorio     â€¢ "Â¡En 2 horas!"   â€¢ "Â¿QuÃ© tal?"   â”‚
â”‚  â€¢ Detalles clase    â€¢ QuÃ© traer        â€¢ Ãšltima hora      â€¢ Link review   â”‚
â”‚  â€¢ Magic link        â€¢ Magic link       â€¢ UbicaciÃ³n GPS    â€¢ Oferta 20%    â”‚
â”‚  â€¢ Mapa ubicaciÃ³n    â€¢ Cancelar link    â€¢ WhatsApp soporte                 â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Cron Jobs con QStash

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                              â”‚
â”‚  CRON JOBS (UPSTASH QSTASH)                                                  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  CRON 1: Recordatorio 24h                                            â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚    â”‚
â”‚  â”‚  Schedule: 0 9 * * * (cada dÃ­a a las 9:00 AM)                       â”‚    â”‚
â”‚  â”‚  Endpoint: POST /api/cron/send-reminders                            â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Flujo:                                                              â”‚    â”‚
â”‚  â”‚  1. Calcular fecha de maÃ±ana                                        â”‚    â”‚
â”‚  â”‚  2. SMEMBERS reminders:{maÃ±ana} â†’ [emails]                          â”‚    â”‚
â”‚  â”‚  3. Para cada email:                                                â”‚    â”‚
â”‚  â”‚     â€¢ GET booking:{email}                                           â”‚    â”‚
â”‚  â”‚     â€¢ Si reminderSent=false && status=confirmed:                    â”‚    â”‚
â”‚  â”‚       - Enviar WhatsApp (template recordatorio_clase)               â”‚    â”‚
â”‚  â”‚       - Enviar Email (Resend)                                       â”‚    â”‚
â”‚  â”‚       - SET reminderSent=true                                       â”‚    â”‚
â”‚  â”‚  4. Responder con stats: { sent: X, skipped: Y }                    â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  CRON 2: Recordatorio 2h                                             â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚    â”‚
â”‚  â”‚  Schedule: 0 * * * * (cada hora en punto)                           â”‚    â”‚
â”‚  â”‚  Endpoint: POST /api/cron/send-reminders-2h                         â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Flujo:                                                              â”‚    â”‚
â”‚  â”‚  1. Calcular ventana: ahora+2h a ahora+3h                           â”‚    â”‚
â”‚  â”‚  2. SMEMBERS reminders:{hoy} â†’ [emails]                             â”‚    â”‚
â”‚  â”‚  3. Para cada email:                                                â”‚    â”‚
â”‚  â”‚     â€¢ GET booking:{email}                                           â”‚    â”‚
â”‚  â”‚     â€¢ Si classTime estÃ¡ en ventana && reminder2hSent=false:         â”‚    â”‚
â”‚  â”‚       - Enviar WhatsApp (template recordatorio_2h)                  â”‚    â”‚
â”‚  â”‚       - SET reminder2hSent=true                                     â”‚    â”‚
â”‚  â”‚  4. Responder con stats                                             â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  CRON 3: Feedback post-clase                                         â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚    â”‚
â”‚  â”‚  Schedule: 0 20 * * * (cada dÃ­a a las 20:00)                        â”‚    â”‚
â”‚  â”‚  Endpoint: POST /api/cron/send-feedback                             â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Flujo:                                                              â”‚    â”‚
â”‚  â”‚  1. Calcular fecha de ayer                                          â”‚    â”‚
â”‚  â”‚  2. SMEMBERS reminders:{ayer} â†’ [emails]                            â”‚    â”‚
â”‚  â”‚  3. Para cada email:                                                â”‚    â”‚
â”‚  â”‚     â€¢ GET booking:{email}                                           â”‚    â”‚
â”‚  â”‚     â€¢ Si feedbackSent=false && status=confirmed:                    â”‚    â”‚
â”‚  â”‚       - Enviar Email feedback + oferta                              â”‚    â”‚
â”‚  â”‚       - SET feedbackSent=true                                       â”‚    â”‚
â”‚  â”‚       - DEL booking:{email} (limpiar despuÃ©s de feedback)           â”‚    â”‚
â”‚  â”‚  4. Responder con stats                                             â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Templates de WhatsApp (Meta Business)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                              â”‚
â”‚  TEMPLATES WHATSAPP (requieren aprobaciÃ³n de Meta)                          â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Template 1: confirmacion_reserva                                    â”‚    â”‚
â”‚  â”‚  CategorÃ­a: UTILITY                                                  â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  ğŸ‰ *Â¡Reserva confirmada!*                                          â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Hola {{1}}, tu clase de prueba estÃ¡ lista:                         â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  ğŸµ *{{2}}*                                                         â”‚    â”‚
â”‚  â”‚  ğŸ“… {{3}}                                                           â”‚    â”‚
â”‚  â”‚  ğŸ• {{4}}                                                           â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  ğŸ“ Farray's Center                                                 â”‚    â”‚
â”‚  â”‚  C/ EntenÃ§a 100, Barcelona                                          â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  [Ver mi reserva] [CÃ³mo llegar]                                     â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Template 2: recordatorio_clase (24h antes)                          â”‚    â”‚
â”‚  â”‚  CategorÃ­a: UTILITY                                                  â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  ğŸ“… *Recordatorio de clase*                                         â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Â¡Hola {{1}}! ğŸ‘‹                                                    â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  MaÃ±ana tienes tu clase de prueba:                                  â”‚    â”‚
â”‚  â”‚  ğŸµ *{{2}}*                                                         â”‚    â”‚
â”‚  â”‚  ğŸ“† {{3}} a las {{4}}                                               â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  ğŸ“ Farray's Center                                                 â”‚    â”‚
â”‚  â”‚  C/ EntenÃ§a 100, Barcelona                                          â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  ğŸ’¡ *Recuerda traer:*                                               â”‚    â”‚
â”‚  â”‚  â€¢ Ropa cÃ³moda                                                      â”‚    â”‚
â”‚  â”‚  â€¢ Agua                                                             â”‚    â”‚
â”‚  â”‚  â€¢ Â¡Ganas de bailar!                                                â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  [Ver reserva] [Cancelar/Cambiar]                                   â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Template 3: recordatorio_2h (2h antes)                              â”‚    â”‚
â”‚  â”‚  CategorÃ­a: UTILITY                                                  â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  â° *Â¡Tu clase empieza en 2 horas!*                                 â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  {{1}}, te esperamos a las {{2}} ğŸ’ƒ                                 â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  ğŸ“ C/ EntenÃ§a 100, Barcelona                                       â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  [Abrir Google Maps]                                                â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Template 4: feedback_clase (24h despuÃ©s)                            â”‚    â”‚
â”‚  â”‚  CategorÃ­a: MARKETING (requiere opt-in)                              â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Â¡Hola {{1}}! ğŸ‘‹                                                    â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Â¿QuÃ© tal tu clase de *{{2}}*?                                      â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Nos encantarÃ­a conocer tu opiniÃ³n â­                                â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  ğŸ *Oferta especial:*                                              â”‚    â”‚
â”‚  â”‚  20% de descuento en tu primera mensualidad                         â”‚    â”‚
â”‚  â”‚  CÃ³digo: PRIMERACLASE20                                             â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  [Dejar reseÃ±a] [Ver bonos]                                         â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Estructura de Datos Redis

### booking:{email}

```typescript
interface BookingData {
  // IdentificaciÃ³n
  email: string;

  // Datos personales
  firstName: string;
  lastName: string;
  phone: string; // E.164: +34666555444

  // Datos de la clase
  sessionId: number; // ID sesiÃ³n Momence
  bookingId: number; // ID booking Momence (para cancelar)
  className: string; // "Bachata Sensual - Principiantes"
  classDate: string; // "2026-01-28" (ISO)
  classTime: string; // "19:00"
  instructor?: string; // "Mathias & Eugenia"

  // Magic Link
  managementToken: string; // crypto.randomBytes(16).toString('hex')

  // Estado
  status: 'confirmed' | 'cancelled';
  reminderSent: boolean; // 24h enviado
  reminder2hSent: boolean; // 2h enviado
  feedbackSent: boolean; // Post-clase enviado

  // Tracking
  eventId: string; // DeduplicaciÃ³n Meta CAPI
  timestamp: number; // Date.now()
  sourceUrl?: string;

  // Consents RGPD
  acceptsTerms: boolean;
  acceptsPrivacy: boolean;
  acceptsMarketing: boolean;
}
```

### Ãndices Redis

| Key                 | Tipo          | Valor               | TTL     | Uso                     |
| ------------------- | ------------- | ------------------- | ------- | ----------------------- |
| `booking:{email}`   | String (JSON) | BookingData         | 30 dÃ­as | Datos completos         |
| `mgmt:{token}`      | String        | email               | 30 dÃ­as | BÃºsqueda por magic link |
| `reminders:{fecha}` | SET           | [email1, email2...] | 7 dÃ­as  | Ãndice para crons       |

---

## Planning de Seguimiento

### Vista General (4 Semanas)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                              â”‚
â”‚  PLANNING DE IMPLEMENTACIÃ“N - 4 SEMANAS                                      â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                                                                              â”‚
â”‚  SEMANA 1                    SEMANA 2                                        â”‚
â”‚  â•â•â•â•â•â•â•â•â•                   â•â•â•â•â•â•â•â•â•                                       â”‚
â”‚  Setup infraestructura       APIs core                                       â”‚
â”‚  â€¢ Upstash Redis             â€¢ Modificar /api/reservar                       â”‚
â”‚  â€¢ Upstash QStash            â€¢ /api/booking/get                              â”‚
â”‚  â€¢ Meta WhatsApp             â€¢ /api/booking/cancel                           â”‚
â”‚  â€¢ Resend Email              â€¢ Tests unitarios                               â”‚
â”‚                                                                              â”‚
â”‚  SEMANA 3                    SEMANA 4                                        â”‚
â”‚  â•â•â•â•â•â•â•â•â•                   â•â•â•â•â•â•â•â•â•                                       â”‚
â”‚  Frontend + Crons            Testing + Deploy                                â”‚
â”‚  â€¢ ManageBookingPage         â€¢ Test E2E completo                             â”‚
â”‚  â€¢ Cron send-reminders       â€¢ Test WhatsApp real                            â”‚
â”‚  â€¢ Cron send-reminders-2h    â€¢ Test Email real                               â”‚
â”‚  â€¢ Cron send-feedback        â€¢ Deploy producciÃ³n                             â”‚
â”‚  â€¢ Traducciones i18n         â€¢ Monitoreo 48h                                 â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Semana 1: Setup Infraestructura

| DÃ­a     | Tarea                        | DuraciÃ³n | Entregable                                    |
| ------- | ---------------------------- | -------- | --------------------------------------------- |
| **Lun** | Setup Upstash Redis          | 1h       | Base de datos creada, credenciales en Vercel  |
| **Lun** | Setup Upstash QStash         | 30min    | Proyecto QStash listo                         |
| **Mar** | Setup Meta WhatsApp Business | 2h       | App creada, nÃºmero verificado                 |
| **Mar** | Crear templates WhatsApp     | 1h       | 4 templates enviados a revisiÃ³n               |
| **MiÃ©** | Setup Resend                 | 30min    | Cuenta + dominio verificado                   |
| **MiÃ©** | Instalar dependencias        | 15min    | `@upstash/redis`, `@upstash/qstash`, `resend` |
| **Jue** | Crear `/api/lib/redis.ts`    | 1h       | Cliente Upstash configurado                   |
| **Jue** | Crear `/api/lib/whatsapp.ts` | 1h       | Helper para enviar WhatsApp                   |
| **Vie** | Crear `/api/lib/email.ts`    | 1h       | Helper para enviar Email                      |
| **Vie** | Test de conexiones           | 1h       | Verificar Redis, WhatsApp, Email funcionan    |

**Checkpoint Semana 1:**

- [ ] Redis conecta y guarda datos
- [ ] WhatsApp templates enviados a aprobaciÃ³n
- [ ] Email de prueba enviado correctamente
- [ ] Todas las credenciales en Vercel

### Semana 2: APIs Core

| DÃ­a     | Tarea                                  | DuraciÃ³n | Entregable                       |
| ------- | -------------------------------------- | -------- | -------------------------------- |
| **Lun** | Modificar `/api/reservar.ts` - Parte 1 | 2h       | Generar managementToken          |
| **Lun** | Modificar `/api/reservar.ts` - Parte 2 | 2h       | Guardar en Redis con Ã­ndices     |
| **Mar** | Modificar `/api/reservar.ts` - Parte 3 | 2h       | Enviar email confirmaciÃ³n        |
| **Mar** | Tests `/api/reservar.ts`               | 1h       | Tests unitarios pasando          |
| **MiÃ©** | Crear `/api/booking/get.ts`            | 2h       | API funcional                    |
| **MiÃ©** | Tests `/api/booking/get.ts`            | 1h       | Tests pasando                    |
| **Jue** | Crear `/api/booking/cancel.ts`         | 3h       | API funcional con limpieza Redis |
| **Jue** | Tests `/api/booking/cancel.ts`         | 1h       | Tests pasando                    |
| **Vie** | Test integraciÃ³n reservar â†’ cancelar   | 2h       | Flujo completo funciona          |
| **Vie** | Documentar APIs                        | 1h       | README con ejemplos curl         |

**Checkpoint Semana 2:**

- [ ] Reserva crea booking + magic link
- [ ] GET /booking/get retorna datos
- [ ] POST /booking/cancel limpia todo
- [ ] DespuÃ©s de cancelar, puede reservar de nuevo

### Semana 3: Frontend + Crons

| DÃ­a     | Tarea                                         | DuraciÃ³n | Entregable                  |
| ------- | --------------------------------------------- | -------- | --------------------------- |
| **Lun** | Crear `ManageBookingPage.tsx`                 | 3h       | Componente base             |
| **Lun** | Estados: loading, confirmed, cancelled, error | 1h       | UI completa                 |
| **Mar** | AÃ±adir ruta en `App.tsx`                      | 30min    | Ruta funcional              |
| **Mar** | AÃ±adir en `prerender.mjs` (4 idiomas)         | 1h       | SSR configurado             |
| **Mar** | Traducciones i18n                             | 2h       | ES/CA/EN/FR                 |
| **MiÃ©** | Crear `/api/cron/send-reminders.ts`           | 2h       | Cron 24h funcional          |
| **MiÃ©** | Crear `/api/cron/send-reminders-2h.ts`        | 1h       | Cron 2h funcional           |
| **Jue** | Crear `/api/cron/send-feedback.ts`            | 1h       | Cron feedback funcional     |
| **Jue** | Crear `setup-qstash-schedules.ts`             | 1h       | Script de setup             |
| **Jue** | Ejecutar script y crear schedules             | 30min    | Crons programados en QStash |
| **Vie** | Test manual de cada cron                      | 2h       | Todos los crons funcionan   |
| **Vie** | Verificar templates WhatsApp aprobados        | -        | Templates listos            |

**Checkpoint Semana 3:**

- [ ] PÃ¡gina /gestionar-reserva funciona
- [ ] CancelaciÃ³n desde pÃ¡gina funciona
- [ ] Cron 24h envÃ­a WhatsApp + Email
- [ ] Cron 2h envÃ­a WhatsApp
- [ ] Cron feedback envÃ­a Email

### Semana 4: Testing + Deploy

| DÃ­a         | Tarea                                      | DuraciÃ³n | Entregable                 |
| ----------- | ------------------------------------------ | -------- | -------------------------- |
| **Lun**     | Test E2E: Reservar â†’ Email confirmaciÃ³n    | 2h       | Flujo verificado           |
| **Lun**     | Test E2E: Reservar â†’ WhatsApp confirmaciÃ³n | 1h       | Flujo verificado           |
| **Mar**     | Test E2E: Recordatorio 24h                 | 2h       | Email + WhatsApp recibidos |
| **Mar**     | Test E2E: Recordatorio 2h                  | 1h       | WhatsApp recibido          |
| **MiÃ©**     | Test E2E: Cancelar â†’ Email cancelaciÃ³n     | 1h       | Flujo verificado           |
| **MiÃ©**     | Test E2E: Cancelar â†’ Reservar de nuevo     | 1h       | DeduplicaciÃ³n funciona     |
| **Jue**     | Test E2E: Feedback post-clase              | 1h       | Email recibido             |
| **Jue**     | Fix bugs encontrados                       | 2h       | Bugs resueltos             |
| **Vie**     | Deploy a producciÃ³n                        | 1h       | Live en producciÃ³n         |
| **Vie**     | Configurar alertas Sentry                  | 30min    | Errores monitoreados       |
| **SÃ¡b-Dom** | Monitoreo 48h                              | -        | Sistema estable            |

**Checkpoint Semana 4:**

- [ ] Todos los tests E2E pasan
- [ ] Sistema en producciÃ³n
- [ ] Primeras reservas reales procesadas
- [ ] No hay errores crÃ­ticos en Sentry

---

## Seguimiento Semanal

### Template de Reporte Semanal

```markdown
## Reporte Semana X - Sistema de Reservas

### Completado âœ…

- [ ] Tarea 1
- [ ] Tarea 2

### En Progreso ğŸ”„

- [ ] Tarea 3 (60%)

### Bloqueado âŒ

- [ ] Tarea 4 - Motivo: ...

### MÃ©tricas

- Reservas creadas: X
- Cancelaciones: X
- Emails enviados: X
- WhatsApp enviados: X
- Errores Sentry: X

### PrÃ³xima Semana

- Prioridad 1: ...
- Prioridad 2: ...
```

---

## Variables de Entorno

```env
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# UPSTASH REDIS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
UPSTASH_REDIS_REST_URL=https://eu1-xxxxx.upstash.io
UPSTASH_REDIS_REST_TOKEN=AXxxxxxxxxxxxxx

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# UPSTASH QSTASH (Cron Jobs)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
QSTASH_TOKEN=eyJxxxxxxxxxxxxx
QSTASH_CURRENT_SIGNING_KEY=sig_xxxxxxxxxxxxx
QSTASH_NEXT_SIGNING_KEY=sig_xxxxxxxxxxxxx

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# MOMENCE OAUTH2
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
MOMENCE_CLIENT_ID=your_client_id
MOMENCE_CLIENT_SECRET=your_client_secret
MOMENCE_USERNAME=your_email
MOMENCE_PASSWORD=your_password
MOMENCE_LOCATION_ID=26485

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# META CONVERSIONS API
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
META_PIXEL_ID=244157012706790
META_CAPI_TOKEN=your_capi_token

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# WHATSAPP CLOUD API (META)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
WHATSAPP_PHONE_ID=your_phone_number_id
WHATSAPP_TOKEN=your_permanent_token

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# RESEND (EMAIL)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RESEND_API_KEY=re_xxxxxxxxxxxxx
```

---

## Costes

| Servicio             | Tier Gratuito    | LÃ­mite   | Suficiente para         |
| -------------------- | ---------------- | -------- | ----------------------- |
| **Upstash Redis**    | 10,000 cmd/dÃ­a   | 300k/mes | ~300 reservas/dÃ­a       |
| **Upstash QStash**   | 500 msg/dÃ­a      | 15k/mes  | ~500 crons/dÃ­a          |
| **WhatsApp Meta**    | 1,000 conv/mes   | -        | ~30 reservas/dÃ­a        |
| **Resend**           | 3,000 emails/mes | -        | ~100 reservas/dÃ­a       |
| **Vercel Functions** | 100 GB-hrs       | -        | PrÃ¡cticamente ilimitado |
| **TOTAL**            | **â‚¬0/mes**       |          | **MÃ¡s que suficiente**  |

---

## Archivos a Crear

```
api/
â”œâ”€â”€ reservar.ts                    â† MODIFICAR
â”œâ”€â”€ booking/
â”‚   â”œâ”€â”€ get.ts                     â† NUEVO
â”‚   â””â”€â”€ cancel.ts                  â† NUEVO
â”œâ”€â”€ cron/
â”‚   â”œâ”€â”€ send-reminders.ts          â† NUEVO
â”‚   â”œâ”€â”€ send-reminders-2h.ts       â† NUEVO
â”‚   â””â”€â”€ send-feedback.ts           â† NUEVO
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ redis.ts                   â† NUEVO
â”‚   â”œâ”€â”€ whatsapp.ts                â† NUEVO
â”‚   â”œâ”€â”€ email.ts                   â† NUEVO
â”‚   â””â”€â”€ momence.ts                 â† NUEVO (refactor)

components/booking/
â”œâ”€â”€ ManageBookingPage.tsx          â† NUEVO

scripts/
â”œâ”€â”€ setup-qstash-schedules.ts      â† NUEVO

App.tsx                            â† MODIFICAR
prerender.mjs                      â† MODIFICAR
i18n/locales/*/booking.json        â† MODIFICAR
```

---

## Dependencias

```bash
npm install @upstash/redis @upstash/qstash resend
```

---

**Documento creado:** 26 Enero 2026
**PrÃ³xima revisiÃ³n:** Al completar Semana 1
